!function(a){var b=angular.module("AngularAOP",[]);b.provider("execute",function(){function b(a){this._advice=a,this._wrapperFunc=null}function c(a){if("function"!=typeof a)throw new Error("The advice should be a function");this.before=AspectBuilder.buildAspect(a,POINTCUTS.BEFORE),this.after=AspectBuilder.buildAspect(a,POINTCUTS.AFTER),this.around=AspectBuilder.buildAspect(a,POINTCUTS.AROUND),this.onThrowOf=AspectBuilder.buildAspect(a,POINTCUTS.ON_THROW),this.onResolveOf=AspectBuilder.buildAspect(a,POINTCUTS.ON_RESOLVE),this.afterResolveOf=AspectBuilder.buildAspect(a,POINTCUTS.AFTER_RESOLVE),this.onRejectOf=AspectBuilder.buildAspect(a,POINTCUTS.ON_REJECT)}function d(a,b,c){angular.forEach(c,function(c){e(a,b,c)})}function e(a,b,d){a.decorator(b,["$q","$injector","$delegate",function(a,b,e){var g="string"==typeof d.advice?b.get(d.advice):d.advice,h=d.jointPoint,i=d.methodPattern,j=d.argsPattern,k=new c(g);if(f=a,"function"!=typeof k[h])throw new Error("No such joint-point "+h);return k[h](e,{methodPattern:i,argsPatterns:j})}])}var f=null,g=Array.prototype.slice,h=function(){var a;return a="function"==typeof String.prototype.trim?String.prototype.trim:function(){return null===this?"":(this+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}(),i=/.*/;return POINTCUTS={BEFORE:"Before",AFTER:"After",AROUND:"Around",ON_THROW:"OnThrow",ON_RESOLVE:"OnResolve",AFTER_RESOLVE:"AfterResolve",ON_REJECT:"OnReject"},Aspects={},AspectBuilder={buildAspect:function(a,b){var c=this;return function(d,e){return"function"==typeof d?c._getFunctionAspect(d,b,a):d?c._getObjectAspect(d,e||{},b,a):void 0}},_getFunctionAspect:function(a,b,c,d){d=d||this._getMethodName(a);var e=new Aspects[b](c),f=function(){var b=g.call(arguments);return b={args:b,context:this,method:a,methodName:d},e._wrapper.call(e,b)};return f.originalMethod=a,e.setWrapper(f),f},_getMethodName:function(a){for(;a.originalMethod;)a=a.originalMethod;return/function\s+(.*?)\s*\(/.exec(a.toString())[1]},_getObjectAspect:function(a,b,c,d){for(var e in a)a.hasOwnProperty(e)&&"function"==typeof a[e]&&this._matchRules(a,e,b)&&(a[e]=this._getFunctionAspect(a[e],c,d,e));return a},_matchRules:function(a,b,c){for(var d=c.methodPattern||i,e=c.argsPatterns||[],f=a[b],g=this._parseMethod(f,b);"__angularAOPWrapper__"===g.when;)f=f.originalMethod,g=this._parseMethod(f,b);return d.test(g.method)&&this._matchArguments(e,g)},_matchArguments:function(a,b){if(b.args.length<a.length)return!1;var c=!0;return angular.forEach(b.args,function(b,d){var e=a[d]||i;return e.test(b)?void 0:(c=!1,void 0)}),c},_parseMethod:function(a,b){var c={method:b},d=a.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,"").match(/function\s+([^\(]*)\s*\(([^\)]*)\)/)||[];return d&&d[2]?(c.args=[],angular.forEach(d[2].split(","),function(a){c.args.push(h.call(a))})):c.args=[],c.when=d[1],c}},b.prototype.setWrapper=function(a){this._wrapperFunc=a},b.prototype._wrapper=function(){throw"Not implemented"},b.prototype.invoke=function(a){var b=(this._wrapperFunc,{});return b.when=this.when,b.method=a.methodName,b.args=a.args,b.exception=a.exception,b.result=a.result,b.resolveArgs=a.resolveArgs,b.rejectArgs=a.rejectArgs,b.result=this._advice.call(a.context,b),b},Aspects[POINTCUTS.BEFORE]=function(){b.apply(this,arguments),this.when="before"},Aspects[POINTCUTS.BEFORE].prototype=Object.create(b.prototype),Aspects[POINTCUTS.BEFORE].prototype._wrapper=function(a){return a.method.apply(a.context,this.invoke(a).args)},Aspects[POINTCUTS.AFTER]=function(){b.apply(this,arguments),this.when="after"},Aspects[POINTCUTS.AFTER].prototype=Object.create(b.prototype),Aspects[POINTCUTS.AFTER].prototype._wrapper=function(a){var b=a.context,c=a.method.apply(b,a.args);return a.result=c,this.invoke(a).result||c},Aspects[POINTCUTS.AROUND]=function(){b.apply(this,arguments),this.when="around"},Aspects[POINTCUTS.AROUND].prototype=Object.create(b.prototype),Aspects[POINTCUTS.AROUND].prototype._wrapper=function(a){var b,c=(a.args,a.context),d=a.method;return b=d.apply(c,this.invoke(a).args),a.result=b,this.invoke(a).result||b},Aspects[POINTCUTS.ON_THROW]=function(){b.apply(this,arguments),this.when="onThrow"},Aspects[POINTCUTS.ON_THROW].prototype=Object.create(b.prototype),Aspects[POINTCUTS.ON_THROW].prototype._wrapper=function(a){var b,c=a.args;try{b=a.method.apply(a.context,c)}catch(d){a.exception=d,this.invoke(a)}return b},Aspects[POINTCUTS.ON_RESOLVE]=function(){b.apply(this,arguments),this.when="onResolve"},Aspects[POINTCUTS.ON_RESOLVE].prototype=Object.create(b.prototype),Aspects[POINTCUTS.ON_RESOLVE].prototype._wrapper=function(a){var b=a.args,c=a.context,d=a.method,e=d.apply(c,b),f=this;return e&&"function"==typeof e.then&&e.then(function(){a.resolveArgs=arguments,f.invoke(a)}),e},Aspects[POINTCUTS.AFTER_RESOLVE]=function(){b.apply(this,arguments),this.when="afterResolve"},Aspects[POINTCUTS.AFTER_RESOLVE].prototype=Object.create(b.prototype),Aspects[POINTCUTS.AFTER_RESOLVE].prototype._wrapper=function(a){var b=a.args,c=a.context,d=a.method,e=f.defer(),g=e.promise,h=d.apply(c,b),i=this;return h.then(function(){a.resolveArgs=arguments,g.then(function(){i.invoke(a)}),e.resolve.apply(e,arguments)},function(){e.reject.apply(g,arguments)}),g},Aspects[POINTCUTS.ON_REJECT]=function(){b.apply(this,arguments),this.when="onReject"},Aspects[POINTCUTS.ON_REJECT].prototype=Object.create(b.prototype),Aspects[POINTCUTS.ON_REJECT].prototype._wrapper=function(b){var c=b.args,d=b.context,e=b.method,f=e.apply(d,c),g=this;return f&&"function"==typeof f.then&&f.then(a,function(){b.rejectArgs=arguments,g.invoke(b)}),f},{annotate:function(a,b){var c;for(var e in b)c=b[e],angular.isArray(c)||(c=[c]),d(a,e,c)},$get:["$q",function(a){return f=a,function(a){return new c(a)}}]}})}();