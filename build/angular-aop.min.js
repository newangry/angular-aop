!function(a,b){"use strict";function c(a){this._advice=a,this._wrapperFunc=null}b["true"]=a,c.prototype.setWrapper=function(a){this._wrapperFunc=a},c.prototype._wrapper=function(){throw"Not implemented"},c.prototype.invoke=function(a){var b={};return b.when=this.when,b.method=a.methodName,b.args=a.args,b.exception=a.exception,b.result=a.result,b.resolveArgs=a.resolveArgs,b.rejectArgs=a.rejectArgs,b.result=this._advice.call(a.context,b),b};var d=angular.module("AngularAOP",[]),e={},f={BEFORE:"Before",BEFORE_ASYNC:"BeforeAsync",AFTER:"After",AROUND:"Around",AROUND_ASYNC:"AroundAsync",ON_THROW:"OnThrow",ON_RESOLVE:"OnResolve",AFTER_RESOLVE:"AfterResolve",ON_REJECT:"OnReject"},g=null;d.provider("execute",function(){function a(a){if("function"!=typeof a)throw new Error("The advice should be a function");this.before=j.buildAspect(a,f.BEFORE),this.beforeAsync=j.buildAspect(a,f.BEFORE_ASYNC),this.after=j.buildAspect(a,f.AFTER),this.around=j.buildAspect(a,f.AROUND),this.aroundAsync=j.buildAspect(a,f.AROUND_ASYNC),this.onThrowOf=j.buildAspect(a,f.ON_THROW),this.onResolveOf=j.buildAspect(a,f.ON_RESOLVE),this.afterResolveOf=j.buildAspect(a,f.AFTER_RESOLVE),this.onRejectOf=j.buildAspect(a,f.ON_REJECT)}function b(a,b,d){angular.forEach(d,function(d){c(a,b,d)})}function c(b,c,d){b.decorator(c,["$q","$injector","$delegate",function(b,c,e){var f="string"==typeof d.advice?c.get(d.advice):d.advice,h=d.jointPoint,i=d.methodPattern,j=d.argsPattern,k=new a(f);if(g=b,"function"!=typeof k[h])throw new Error("No such joint-point "+h);return k[h](e,{methodPattern:i,argsPatterns:j})}])}var d=/.*/,h=Array.prototype.slice,i=function(){var a;return a="function"==typeof String.prototype.trim?String.prototype.trim:function(){return null===this?"":(this+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}(),j={buildAspect:function(a,b){var c=this;return function(d,e){return"function"==typeof d?c._getFunctionAspect(d,b,a):d?c._getObjectAspect(d,e||{},b,a):void 0}},_getFunctionAspect:function(a,b,c,d){d=d||this._getMethodName(a);var f=new e[b](c),g=function(){var b=h.call(arguments);return b={args:b,context:this,method:a,methodName:d},f._wrapper.call(f,b)};return g.originalMethod=a,f.setWrapper(g),g},_getMethodName:function(a){for(;a.originalMethod;)a=a.originalMethod;return/function\s+(.*?)\s*\(/.exec(a.toString())[1]},_getObjectAspect:function(a,b,c,d){for(var e in a)a.hasOwnProperty(e)&&"function"==typeof a[e]&&this._matchRules(a,e,b)&&(a[e]=this._getFunctionAspect(a[e],c,d,e));return a},_matchRules:function(a,b,c){for(var e=c.methodPattern||d,f=c.argsPatterns||[],g=a[b],h=this._parseMethod(g,b);"__angularAOPWrapper__"===h.when;)g=g.originalMethod,h=this._parseMethod(g,b);return e.test(h.method)&&this._matchArguments(f,h)},_matchArguments:function(a,b){if(b.args.length<a.length)return!1;var c=!0;return angular.forEach(b.args,function(b,e){var f=a[e]||d;return f.test(b)?void 0:(c=!1,void 0)}),c},_parseMethod:function(a,b){var c={method:b},d=a.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,"").match(/function\s+([^\(]*)\s*\(([^\)]*)\)/)||[];return d&&d[2]?(c.args=[],angular.forEach(d[2].split(","),function(a){c.args.push(i.call(a))})):c.args=[],c.when=d[1],c}};return{annotate:function(a,c){var d;for(var e in c)d=c[e],angular.isArray(d)||(d=[d]),b(a,e,d)},$get:["$q",function(b){return g=b,function(b){return new a(b)}}]}}),e[f.AFTER]=function(){c.apply(this,arguments),this.when=f.AFTER},e[f.AFTER].prototype=Object.create(c.prototype),e[f.AFTER].prototype._wrapper=function(a){var b=a.context,c=a.method.apply(b,a.args);return a.result=c,this.invoke(a).result||c},e[f.AFTER_RESOLVE]=function(){c.apply(this,arguments),this.when=f.AFTER_RESOLVE},e[f.AFTER_RESOLVE].prototype=Object.create(c.prototype),e[f.AFTER_RESOLVE].prototype._wrapper=function(a){var b=a.args,c=a.context,d=a.method,e=g.defer(),f=e.promise,h=d.apply(c,b),i=this;return h.then(function(){a.resolveArgs=arguments,f.then(function(){i.invoke(a)}),e.resolve.apply(e,arguments)},function(){e.reject.apply(f,arguments)}),f},e[f.AROUND_ASYNC]=function(){c.apply(this,arguments),this.when=f.AROUND_ASYNC},e[f.AROUND_ASYNC].prototype=Object.create(c.prototype),e[f.AROUND_ASYNC].prototype._wrapper=function(a){function b(){return c=e.apply(d,f.result),a.result=c,h.invoke(a).result||c}var c,d=a.context,e=a.method,f=this.invoke(a),h=this;return g.when(f.result).then(b,b)},e[f.AROUND]=function(){c.apply(this,arguments),this.when=f.AROUND},e[f.AROUND].prototype=Object.create(c.prototype),e[f.AROUND].prototype._wrapper=function(a){var b,c=a.context,d=a.method;return b=d.apply(c,this.invoke(a).args),a.result=b,this.invoke(a).result||b},e[f.BEFORE_ASYNC]=function(){c.apply(this,arguments),this.when=f.BEFORE_ASYNC},e[f.BEFORE_ASYNC].prototype=Object.create(c.prototype),e[f.BEFORE_ASYNC].prototype._wrapper=function(a){var b=this.invoke(a);return g.when(b.result).then(function(){return a.method.apply(a.context,b.args)},function(){return a.method.apply(a.context,b.args)})},e[f.BEFORE]=function(){c.apply(this,arguments),this.when=f.BEFORE},e[f.BEFORE].prototype=Object.create(c.prototype),e[f.BEFORE].prototype._wrapper=function(a){return a.method.apply(a.context,this.invoke(a).args)},e[f.ON_REJECT]=function(){c.apply(this,arguments),this.when=f.ON_REJECT},e[f.ON_REJECT].prototype=Object.create(c.prototype),e[f.ON_REJECT].prototype._wrapper=function(a){var b=a.args,c=a.context,d=a.method,e=d.apply(c,b),f=this;return e&&"function"==typeof e.then&&e.then(void 0,function(){a.rejectArgs=arguments,f.invoke(a)}),e},e[f.ON_RESOLVE]=function(){c.apply(this,arguments),this.when=f.ON_RESOLVE},e[f.ON_RESOLVE].prototype=Object.create(c.prototype),e[f.ON_RESOLVE].prototype._wrapper=function(a){var b=a.args,c=a.context,d=a.method,e=d.apply(c,b),f=this;return e&&"function"==typeof e.then&&e.then(function(){a.resolveArgs=arguments,f.invoke(a)}),e},e[f.ON_THROW]=function(){c.apply(this,arguments),this.when=f.ON_THROW},e[f.ON_THROW].prototype=Object.create(c.prototype),e[f.ON_THROW].prototype._wrapper=function(a){var b,c=a.args;try{b=a.method.apply(a.context,c)}catch(d){a.exception=d,this.invoke(a)}return b}}({},function(){return this}());